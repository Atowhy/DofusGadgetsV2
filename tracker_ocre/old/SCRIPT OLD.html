<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DofusDB Monster ID and Portrait Fetcher</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* bg-gray-900 */
            color: #e2e8f0; /* Light text */
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; /* Align to top for content display */
            padding: 20px;
        }
        .container {
            background-color: rgba(31, 41, 55, 0.85); /* bg-gray-800 with 85% opacity */
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.75rem; /* rounded-xl */
            padding: 2rem; /* p-8 */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* shadow-lg */
            text-align: center;
            max-width: 800px; /* Increased max-width for image display */
            width: 100%;
            margin-bottom: 20px; /* Space below the main container */
        }
        h1 {
            font-size: 1.875rem; /* text-3xl */
            font-weight: 700; /* font-bold */
            color: #4fd1c5; /* text-teal-300 */
            margin-bottom: 1rem;
        }
        p {
            font-size: 1rem; /* text-base */
            color: #cbd5e0; /* text-gray-300 */
            margin-bottom: 1.5rem;
        }
        .button-group {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 1.5rem;
            flex-wrap: wrap; /* Allow buttons to wrap on smaller screens */
        }
        button {
            background-color: #0d9488; /* bg-teal-700 */
            color: white;
            font-weight: 700; /* font-bold */
            padding: 0.75rem 1.5rem; /* py-3 px-6 */
            border-radius: 0.5rem; /* rounded-lg */
            transition: background-color 0.3s ease, transform 0.2s ease;
            cursor: pointer;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        button:hover {
            background-color: #0f766e; /* hover:bg-teal-800 */
            transform: scale(1.05);
        }
        button:disabled {
            background-color: #4b5563; /* gray-600 */
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .message {
            margin-top: 1.5rem;
            padding: 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            display: none; /* Hidden by default */
        }
        .message.info {
            background-color: rgba(59, 130, 246, 0.1); /* Blue-500 with opacity */
            color: #3b82f6; /* text-blue-500 */
            border-left: 4px solid #3b82f6; /* border-blue-500 */
            display: block;
        }
        .message.success {
            background-color: rgba(20, 184, 166, 0.1); /* Teal-500 with opacity */
            color: #14b8a6; /* text-teal-500 */
            border-left: 4px solid #14b8a6; /* border-teal-500 */
            display: block;
        }
        .message.error {
            background-color: rgba(239, 68, 68, 0.1); /* Red-500 with opacity */
            color: #ef4444; /* text-red-500 */
            border-left: 4px solid #ef4444; /* border-red-500 */
            display: block;
        }
        /* New styles for monster list */
        #monsterListContainer {
            background-color: rgba(31, 41, 55, 0.85);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.75rem;
            padding: 2rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            max-width: 800px;
            width: 100%;
            margin-top: 20px;
            display: none; /* Hidden by default, shown when results are ready */
        }
        #monsterGrid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); /* Responsive grid */
            gap: 1rem;
            justify-items: center;
        }
        .monster-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 0.5rem;
            border-radius: 0.5rem;
            background-color: rgba(55, 65, 81, 0.5); /* bg-gray-700 with opacity */
            transition: background-color 0.2s ease;
        }
        .monster-item:hover {
            background-color: rgba(55, 65, 81, 0.7);
        }
        .monster-item img {
            width: 80px; /* Fixed size for portraits */
            height: 80px;
            object-fit: contain;
            border-radius: 0.25rem;
            margin-bottom: 0.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background-color: rgba(255, 255, 255, 0.05);
        }
        .monster-item p {
            font-size: 0.875rem; /* text-sm */
            line-height: 1.2;
            margin-bottom: 0.25rem;
            color: #e2e8f0;
        }
        .monster-item .monster-id {
            font-size: 0.75rem; /* text-xs */
            color: #9ca3af; /* text-gray-400 */
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>DofusDB Monster ID and Portrait Fetcher</h1>
        <p>Cliquez sur le bouton ci-dessous pour récupérer les portraits des monstres à partir de leurs IDs intégrés. Les résultats apparaîtront ci-dessous et dans la console.</p>
        <div class="button-group">
            <button id="fetchMonstersBtn">Récupérer les Monstres</button>
            <button id="copyResultsBtn" disabled>Copier les IDs</button>
            <button id="downloadAllBtn" disabled>Télécharger tous les portraits</button>
        </div>
        <div id="statusMessage" class="message info">
            Cliquez sur "Récupérer les Monstres" pour commencer.
        </div>
    </div>

    <div id="monsterListContainer">
        <h2 class="text-xl font-semibold text-teal-300 mb-4">Portraits des Monstres</h2>
        <div id="monsterGrid">
            <!-- Monster portraits and info will be displayed here -->
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const fetchButton = document.getElementById('fetchMonstersBtn');
            const copyButton = document.getElementById('copyResultsBtn');
            const downloadAllButton = document.getElementById('downloadAllBtn'); // New button
            const statusMessageDiv = document.getElementById('statusMessage');
            const monsterListContainer = document.getElementById('monsterListContainer');
            const monsterGrid = document.getElementById('monsterGrid');
            const DOFUSDB_API_BASE_URL = 'https://api.dofusdb.fr';

            let monsterResults = {}; // Stores complete results (name, id, img)

            // Embedded monster data
            const monstersToFetch = [
                { name: "Souris Grise", id: 126 },
                { name: "Moskito", id: 7608 },
                { name: "Arakne", id: 8084 },
                { name: "Boufton Blanc", id: 435 },
                { name: "Boufton Noir", id: 149 },
                { name: "Tofu Maléfique", id: 6728 },
                { name: "Arakne Malade", id: 474 },
                { name: "Piou Bleu", id: 491 },
                { name: "Piou Jaune", id: 493 },
                { name: "Piou Rouge", id: 489 },
                { name: "Piou Vert", id: 490 },
                { name: "Piou Violet", id: 236 },
                { name: "Piou Rose", id: 492 },
                { name: "Flammèche Air", id: 5498 },
                { name: "Flammèche Eau", id: 5497 },
                { name: "Flammèche Feu", id: 5496 },
                { name: "Flammèche Terre", id: 5495 },
                { name: "Larve Bleue", id: 7987 },
                { name: "Crabe", id: 6357 },
                { name: "Tofu", id: 7960 },
                { name: "Tofu Malade", id: 5285 },
                { name: "Champ Champ", id: 59 },
                { name: "Pissenlit Diabolique", id: 79 },
                { name: "Arakne des Égouts", id: 255 },
                { name: "Bandit Manchot", id: 466 },
                { name: "Rose Démoniaque", id: 78 },
                { name: "Gelée Bleue", id: 55 },
                { name: "Gelée Menthe", id: 56 },
                { name: "Kwoan", id: 3277 },
                { name: "Larve Verte", id: 7990 },
                { name: "Bouftou", id: 6781 },
                { name: "Kolérat", id: 4875 },
                { name: "Larve Orange", id: 7989 },
                { name: "Boulanger Sombre", id: 153 },
                { name: "Black Tiwabbit", id: 899 },
                { name: "Tiwabbit", id: 6200 },
                { name: "Tournesol Sauvage", id: 48 },
                { name: "Bandit du clan des Roublards", id: 155 },
                { name: "Gobet", id: 7001 },
                { name: "NodKoko", id: 4232 },
                { name: "Trukikol", id: 5008 },
                { name: "Tikoko", id: 208 },
                { name: "Sanglier", id: 5300 },
                { name: "Champa Vert", id: 7762 },
                { name: "Crowneille", id: 3096 },
                { name: "Vampire", id: 5048 },
                { name: "Biblop Coco", id: 7969 },
                { name: "Biblop Griotte", id: 7967 },
                { name: "Biblop Indigo", id: 7968 },
                { name: "Biblop Reinette", id: 7966 },
                { name: "Gob-trotteur", id: 62 },
                { name: "Milirat Strubien", id: 475 },
                { name: "Boo", id: 6938 },
                { name: "Prespic", id: 4786 },
                { name: "Cochon de Lait", id: 123 },
                { name: "Tortue Jaune", id: 223 },
                { name: "Wabbit", id: 8003 },
                { name: "Chef de Guerre Bouftou", id: 148 },
                { name: "Berger Porkass", id: 344 },
                { name: "Croc Gland", id: 2622 },
                { name: "Floristile", id: 6349 },
                { name: "Tortue Bleue", id: 221 },
                { name: "Tortue Rouge", id: 220 },
                { name: "Tortue Verte", id: 222 },
                { name: "Corbac", id: 7952 },
                { name: "Etoile de la Mer d'Asse", id: 927 },
                { name: "Pichon Blanc", id: 922 },
                { name: "Pichon Bleu", id: 8020 },
                { name: "Pichon Orange", id: 8019 },
                { name: "Pichon Vert", id: 923 },
                { name: "Bambouto", id: 6346 },
                { name: "Maître Vampire", id: 124 },
                { name: "Minoskito", id: 2698 },
                { name: "Noeul", id: 6206 },
                { name: "Milimulou", id: 7327 },
                { name: "Fourbasse", id: 4475 },
                { name: "Bulbiflore", id: 6322 },
                { name: "Bwork Mage", id: 4782 },
                { name: "Croc Gland Enragé", id: 397 },
                { name: "Rose Obscure", id: 467 },
                { name: "Black Wabbit", id: 4982 },
                { name: "Mineur Sombre", id: 8035 },
                { name: "Bwork Archer", id: 4209 },
                { name: "Champa Bleu", id: 7759 },
                { name: "Champa Marron", id: 7760 },
                { name: "Champa Rouge", id: 7761 },
                { name: "Craqueboule", id: 7297 },
                { name: "Mandrine", id: 4852 },
                { name: "Ishigro Pake", id: 6363 },
                { name: "Gargrouille", id: 5243 },
                { name: "Dragodinde Amande Sauvage", id: 171 },
                { name: "Gelée Fraise", id: 57 },
                { name: "Wabbit Squelette", id: 3473 },
                { name: "Chafer Invisible", id: 5055 },
                { name: "Craqueleur", id: 6799 },
                { name: "Bwork", id: 6818 },
                { name: "Abraknyde", id: 7398 },
                { name: "Kraméléhon", id: 836 },
                { name: "Scarafeuille Blanc", id: 241 },
                { name: "Scarafeuille Bleu", id: 198 },
                { name: "Scarafeuille Rouge", id: 194 },
                { name: "Scarafeuille Vert", id: 240 },
                { name: "Rib", id: 6059 },
                { name: "Blop Coco", id: 7973 },
                { name: "Blop Griotte", id: 7971 },
                { name: "Blop Indigo", id: 7972 },
                { name: "Blop Reinette", id: 7970 },
                { name: "Cochon de Farle", id: 603 },
                { name: "Scaratos", id: 830 },
                { name: "Boomba", id: 4223 },
                { name: "Tronknyde", id: 7351 },
                { name: "Chafer Fantassin", id: 5054 },
                { name: "Pichon Kloune", id: 924 },
                { name: "Abrakne", id: 7349 },
                { name: "Chafer", id: 6822 },
                { name: "Crocodaille", id: 6548 },
                { name: "Scélérat Strubien", id: 465 },
                { name: "Scorbute", id: 3099 },
                { name: "Dragodinde Rousse Sauvage", id: 200 },
                { name: "Forgeron Sombre", id: 119 },
                { name: "Crustorail Kouraçao", id: 1060 },
                { name: "Crustorail Malibout", id: 1061 },
                { name: "Crustorail Morito", id: 1063 },
                { name: "Crustorail Passaoh", id: 1062 },
                { name: "Bulbuisson", id: 6347 },
                { name: "Arakne Majeure", id: 2630 },
                { name: "Akakwa", id: 6506 },
                { name: "Grand Pa Wabbit", id: 99 },
                { name: "Wo Wabbit", id: 97 },
                { name: "Cavalier Porkass", id: 343 },
                { name: "Amlub", id: 385 },
                { name: "Codem", id: 386 },
                { name: "Kirevam", id: 388 },
                { name: "Let Emoliug", id: 389 },
                { name: "Aboub", id: 4787 },
                { name: "Gink", id: 4780 },
                { name: "Negbib", id: 390 },
                { name: "Nipul", id: 2540 },
                { name: "Osurc", id: 4778 },
                { name: "Susej", id: 393 },
                { name: "Kokoko", id: 209 },
                { name: "Chafer Archer", id: 5065 },
                { name: "Chafer Lancier", id: 5067 },
                { name: "DoK Alako", id: 747 },
                { name: "Koalak Immature", id: 748 },
                { name: "Gamino", id: 668 },
                { name: "Ramane d'Egoutant", id: 447 },
                { name: "Le Ouassingue Entourbé", id: 1096 },
                { name: "Le Ouassingue", id: 5247 },
                { name: "La Ouassingue", id: 5244 },
                { name: "Palmifleur Malibout", id: 1065 },
                { name: "Palmifleur Morito", id: 1067 },
                { name: "Palmifleur Passaoh", id: 1066 },
                { name: "Sanglier Des Plaines", id: 297 },
                { name: "Abraknyde Vénérable", id: 7343 },
                { name: "Craqueleur des plaines", id: 2882 },
                { name: "Fangshu", id: 6636 },
                { name: "Chafer d'élite", id: 5066 },
                { name: "Maître Bolet", id: 5290 },
                { name: "Craqueboule Poli", id: 5705 },
                { name: "Ino-Naru", id: 6214 },
                { name: "Kanniboul Ark", id: 211 },
                { name: "Kanniboul Jav", id: 213 },
                { name: "Kanniboul Sarbak", id: 214 },
                { name: "Kanniboul Eth", id: 212 },
                { name: "Sarkapwane", id: 6507 },
                { name: "Rat d'Egoutant", id: 4875 },
                { name: "Palmifleur Kouraçao", id: 1064 },
                { name: "Macien", id: 301 },
                { name: "Kwak de Vent", id: 81 },
                { name: "Kwak de Flamme", id: 83 },
                { name: "Kwak de Glace", id: 84 },
                { name: "Kwak de Terre", id: 235 },
                { name: "Porsalu", id: 3304 },
                { name: "Dragacé", id: 5804 },
                { name: "Chafer Draugr", id: 5053 },
                { name: "Vétauran", id: 5291 },
                { name: "Crachefoux", id: 7950 },
                { name: "Serpiplume", id: 829 },
                { name: "Corailleur", id: 3879 },
                { name: "Lolojiki", id: 6223 },
                { name: "Raul Mops", id: 926 },
                { name: "Félygiène", id: 3559 },
                { name: "Betto", id: 6505 },
                { name: "Moumoule", id: 954 },
                { name: "Canondorf", id: 5061 },
                { name: "Nakunbra", id: 5036 },
                { name: "Don Duss Ang", id: 600 },
                { name: "DragOeuf Calcaire", id: 90 },
                { name: "DragOeuf Argile", id: 87 },
                { name: "DragOeuf Charbon", id: 89 },
                { name: "DragOeuf Ardoise", id: 170 },
                { name: "Koalak Coco", id: 752 },
                { name: "Koalak Griotte", id: 753 },
                { name: "Koalak Indigo", id: 751 },
                { name: "Koalak Reinette", id: 754 },
                { name: "Rat d'Hyoactif", id: 449 },
                { name: "Sparo", id: 2588 },
                { name: "Chiendent", id: 5697 },
                { name: "Fantôme Apero", id: 932 },
                { name: "Fantôme aux Plates", id: 378 },
                { name: "Fantôme Hicide", id: 380 },
                { name: "Fantôme Égérie", id: 379 },
                { name: "Don Dorgan", id: 601 },
                { name: "Barbroussa", id: 1049 },
                { name: "Le Flib", id: 3803 },
                { name: "Nerbe", id: 5696 },
                { name: "Chef Crocodaille", id: 263 },
                { name: "Serpentin", id: 4569 },
                { name: "Kanigrou", id: 6140 },
                { name: "Bitouf des plaines", id: 5704 },
                { name: "Craqueleur poli", id: 5706 },
                { name: "Mufafah", id: 5708 },
                { name: "Mulou", id: 7328 },
                { name: "Kurookin", id: 6638 },
                { name: "Kido", id: 5707 },
                { name: "Kilibriss", id: 5703 },
                { name: "Larve Champêtre", id: 4548 },
                { name: "Bourdard", id: 7299 },
                { name: "Foufayteur", id: 5288 },
                { name: "Panthégros", id: 3632 },
                { name: "Dragueuse", id: 855 },
                { name: "Guerrier koalak", id: 749 },
                { name: "Kokom", id: 6371 },
                { name: "Orfélin", id: 6056 },
                { name: "Warko marron", id: 746 },
                { name: "Parashukouï", id: 6222 },
                { name: "Abraknyde sombre", id: 7342 },
                { name: "Alhyène", id: 3558 },
                { name: "Fossoyeur koalak", id: 761 },
                { name: "Koalak forestier", id: 785 },
                { name: "Piralak", id: 784 },
                { name: "Pékeualak", id: 786 },
                { name: "Gloutovore", id: 5436 },
                { name: "Abrakne sombre", id: 7341 },
                { name: "Dragodinde dorée sauvage", id: 666 },
                { name: "Chevaucheur koalak", id: 759 },
                { name: "Meupette", id: 1046 },
                { name: "Grenufar", id: 6348 },
                { name: "Dragnarok", id: 853 },
                { name: "Draguaindrop", id: 862 },
                { name: "Bizarbwork", id: 4626 },
                { name: "Médibwork", id: 4627 },
                { name: "Krambwork", id: 4628 },
                { name: "Mégabwork", id: 4625 },
                { name: "Disciple Zoth", id: 1055 },
                { name: "Brouture", id: 5700 },
                { name: "Koalak sanguin", id: 744 },
                { name: "Bitouf sombre", id: 5699 },
                { name: "Floribonde", id: 5701 },
                { name: "Fécorce", id: 5702 },
                { name: "Koalak Farouche", id: 756 },
                { name: "Mama Koalak", id: 755 },
                { name: "Momie Koalak", id: 760 },
                { name: "Bourbassingue", id: 1059 },
                { name: "Warko Violet", id: 745 },
                { name: "Gamine Zoth", id: 1053 },
                { name: "Guerrier Zoth", id: 1054 },
                { name: "Tourbassingue", id: 1058 },
                { name: "Abrakleur sombre", id: 5698 },
                { name: "Dragoss Calcaire", id: 878 },
                { name: "Dragoss Argile", id: 879 },
                { name: "Dragoss Charbon", id: 858 },
                { name: "Dragoss Ardoise", id: 905 },
                { name: "Rouquette", id: 6589 },
                { name: "Tétonuki", id: 6221 },
                { name: "Boumbardier", id: 6586 },
                { name: "Drakoalak", id: 763 },
                { name: "Fauchalak", id: 5022 },
                { name: "Maître koalak", id: 758 },
                { name: "Poolay", id: 6908 },
                { name: "Malle Outillée", id: 4597 },
                { name: "Robot Fléau", id: 4596 },
                { name: "Robionicle", id: 6040 },
                { name: "Kaniblou", id: 3636 },
                { name: "Troollaraj", id: 233 },
                { name: "Sergent Zoth", id: 1056 },
                { name: "Maître Zoth", id: 1052 },
                { name: "Kaskargo", id: 1044 },
                { name: "Bitouf Aérien", id: 1020 },
                { name: "Abrakleur Clair", id: 1047 },
                { name: "Pétartifoux", id: 6588 },
                { name: "Champaknyde", id: 1154 },
                { name: "Tromperelle", id: 1153 },
                { name: "Champodonte", id: 1155 },
                { name: "Champbis", id: 1157 },
                { name: "Champ à Gnons", id: 4925 },
                { name: "Champmane", id: 1156 },
                { name: "Tsukinochi", id: 6460 },
                { name: "Tambouraï", id: 6384 },
                { name: "Onabu-Geisha", id: 6385 },
                { name: "Jianshi-Nobi", id: 6386 },
                { name: "Lichangoro", id: 6639 },
                { name: "Roissingue", id: 1057 },
                { name: "Madura", id: 6408 },
                { name: "Bakazako", id: 6634 },
                { name: "Kaonashi", id: 6635 },
                { name: "Tsume-Bozu", id: 6392 },
                { name: "Mob l'Éponge", id: 928 },
                { name: "Bouftou Royal", id: 1190 },
                { name: "Tournesol Affamé", id: 799 },
                { name: "Gelée Royale Bleue", id: 58 },
                { name: "Gelée Royale Menthe", id: 85 },
                { name: "Shin Larve", id: 457 },
                { name: "Wabbit GM", id: 3867 },
                { name: "Scarabosse Doré", id: 797 },
                { name: "Bworkette", id: 792 },
                { name: "Dragon Cochon", id: 1191 },
                { name: "Maître Corbac", id: 289 },
                { name: "Mominotor", id: 831 },
                { name: "Déminoboule", id: 832 },
                { name: "Tofu Royal", id: 382 },
                { name: "Blop Coco Royal", id: 7973 },
                { name: "Blop Griotte Royal", id: 7971 },
                { name: "Blop Indigo Royal", id: 7972 },
                { name: "Blop Reinette Royal", id: 7970 },
                { name: "Rat Noir", id: 939 },
                { name: "Rat Blanc", id: 940 },
                { name: "Minotoror", id: 2611 },
                { name: "Hell Mina", id: 3599 },
                { name: "Tanukouï San", id: 6218 },
                { name: "Craqueleur Légendaire", id: 669 },
                { name: "Gardienne des Égouts", id: 450 },
                { name: "Gelée Royale Fraise", id: 86 },
                { name: "Blop Multicolore Royal", id: 1188 },
                { name: "Corailleur Magistral", id: 1027 },
                { name: "Gourlo le Terrible", id: 1051 },
                { name: "Meulou", id: 4870 },
                { name: "Wa Wabbit", id: 180 },
                { name: "Moon", id: 226 },
                { name: "Koulosse", id: 670 },
                { name: "Skeunk", id: 780 },
                { name: "Abraknyde ancestral", id: 173 },
                { name: "Hanshi", id: 6212 },
                { name: "Tynril Ahuri", id: 1087 },
                { name: "Tynril Consterné", id: 1072 },
                { name: "Tynril Déconcerté", id: 1085 },
                { name: "Tynril Perfide", id: 1086 },
                { name: "Gelée Royale Citron", id: 430 },
                { name: "Founamboul", id: 6255 },
                { name: "Bworker", id: 478 },
                { name: "Sphincter Cell", id: 943 },
                { name: "Minotot", id: 827 },
                { name: "Silf le Rasboul Majeur", id: 1071 },
                { name: "Crocabulia", id: 854 },
                { name: "Haute Truche", id: 3618 },
                { name: "Chêne mou", id: 257 },
                { name: "Ougah", id: 4999 },
                { name: "Kimbo", id: 1088 },
                { name: "Sousourizoto le Collant", id: 2354 },
                { name: "Mosketère le Dévoué", id: 2336 },
                { name: "Arakule la Revancharde", id: 2310 },
                { name: "Boudalf le Blanc", id: 2315 },
                { name: "Boulgourvil le Lointain", id: 2316 },
                { name: "Tofumanchou l'Empereur", id: 2357 },
                { name: "Arachitik la Souffreteuse", id: 2312 },
                { name: "Pioustone le Problème", id: 2341 },
                { name: "Pioulbrineur le Mercenaire", id: 2342 },
                { name: "Pioulette la Coquine", id: 2344 },
                { name: "Pioukas la Plante", id: 2345 },
                { name: "Pioussokrim le Délétère", id: 2347 },
                { name: "Craraboss le Féérique", id: 2327 },
                { name: "Larvonika l'Instrument", id: 2574 },
                { name: "Pioufe la Maquillée", id: 2343 },
                { name: "Tofuldebeu l'Explosif", id: 2355 },
                { name: "Tofurapin le Pétri", id: 2356 },
                { name: "Chamchie le Difficile", id: 2323 },
                { name: "Pissdane l'Insipide", id: 2348 },
                { name: "Araknay la Galopante", id: 2393 },
                { name: "Bandapar l'exclu", id: 2313 },
                { name: "Roz la Magicienne", id: 2352 },
                { name: "Gelanal le Huileux", id: 2487 },
                { name: "Kwoanneur le Frimeur", id: 2522 },
                { name: "Larchimaide la poussée", id: 2332 },
                { name: "Boufdégou le Refoulant", id: 2317 },
                { name: "Kolforthe l'Indécollable", id: 2520 },
                { name: "Geloliaine l'Aérien", id: 2371 },
                { name: "Larvapstrè le Subjectif", id: 2331 },
                { name: "Serpistol l'Illustre", id: 2286 },
                { name: "Tiwa'Missou le Gateux", id: 2402 },
                { name: "Boudur le Raide", id: 2318 },
                { name: "Boulanger sombre", id: 153 },
                { name: "Tiwalpé le Dévêtu", id: 2293 },
                { name: "Tiwoflan le Lâche", id: 2294 },
                { name: "Tour le Vice", id: 2358 },
                { name: "Bandson le Tonitruant", id: 2314 },
                { name: "Bandit du Clan des Roublards", id: 155 },
                { name: "Gobstiniais le Têtu", id: 2494 },
                { name: "Nodkoku le Trahi", id: 2541 },
                { name: "Nodkoko", id: 4232 },
                { name: "Tikosto le Mousse", id: 2292 },
                { name: "Tikoko", id: 208 },
                { name: "Trukul le Lent", id: 2301 },
                { name: "Sangria le Fruité", id: 2353 },
                { name: "Champayr le Disjoncté", id: 2427 },
                { name: "Étoilette la Bouchée", id: 2431 },
                { name: "Étoile de la Mer d'Asse", id: 927 },
                { name: "Vampunor le Glacial", id: 2302 },
                { name: "Bilvoezé le Bonimenteur", id: 2399 },
                { name: "Bi le Partageur", id: 2400 },
                { name: "Bistou le Quêteur", id: 2396 },
                { name: "Bistou le Rieur", id: 2401 },
                { name: "Chevaustine le Reconstruit", id: 2430 },
                { name: "Milipussien le Géant", id: 2334 },
                { name: "Boostif l'Affamé", id: 2549 },
                { name: "Preskapwal le Tendancieux", id: 2349 },
                { name: "Chonstip la Passagère", id: 2325 },
                { name: "Torthur la Lutte", id: 2298 },
                { name: "Wabbitud le Constant", id: 2304 },
                { name: "Porfavor le Quémandeur", id: 2397 },
                { name: "Robiolego l'Assemblé", id: 2411 },
                { name: "Bouflet le Puéril", id: 2324 },
                { name: "Cromikay le Néophyte", id: 2378 },
                { name: "Tortenssia la Fleurie", id: 2295 },
                { name: "Bambouské le Camouflé", id: 2548 },
                { name: "Corpat le Vampire", id: 2437 },
                { name: "Pichduitre le Totem", id: 2346 },
                { name: "Pichdourse le Puissant", id: 2338 },
                { name: "Pichtoire l'Erudit", id: 2340 },
                { name: "Pichakoté le Dégoûtant", id: 2272 },
                { name: "Tortorak le Cornu", id: 2297 },
                { name: "Maître Amboat le Moqueur", id: 2532 },
                { name: "Robocoop l'Échangé", id: 2413 },
                { name: "Fourapin le Chaud", id: 2484 },
                { name: "Milipatte la Griffe", id: 2333 },
                { name: "Minoskour le Sauveur", id: 2533 },
                { name: "Neufedur le Flottant", id: 2542 },
                { name: "Tortilleur le Coulé", id: 2296 },
                { name: "Bwormage le Respectueux", id: 2418 },
                { name: "Wagnagnah le Sanglant", id: 2403 },
                { name: "Crognan le Barbare", id: 2440 },
                { name: "Rostensyl la Cuisinière", id: 2277 },
                { name: "Minsinistre l'Elu", id: 2335 },
                { name: "Barchwork le Multicolore", id: 2417 },
                { name: "Champayt l'Odorant", id: 2424 },
                { name: "Chamflay le Ballonné", id: 2425 },
                { name: "Chamdblé le Cultivé", id: 2426 },
                { name: "Craquetuss le Piquant", id: 2326 },
                { name: "Mandalo l'Aqueuse", id: 2529 },
                { name: "Mallopiée l'Épineuse", id: 2329 },
                { name: "Garsim le Mort", id: 2486 },
                { name: "Draglida la Disparue", id: 2379 },
                { name: "Gelaviv le Glaçon", id: 2376 },
                { name: "Watdogue le Bien Nommé", id: 2305 },
                { name: "Chafalfer l'Optimiste", id: 2321 },
                { name: "Crakmitaine le Faucheur", id: 2436 },
                { name: "Bworkasse le Dégoûtant", id: 2416 },
                { name: "Abrakroc l'Edenté", id: 2309 },
                { name: "Krapahut le Randonneur", id: 2521 },
                { name: "Scapé l'Epée", id: 2280 },
                { name: "Scarfayss le Balafré", id: 2281 },
                { name: "Scarouarze l'Epopée", id: 2282 },
                { name: "Scaramel le Fondant", id: 2283 },
                { name: "Ribibi le Cher", id: 2276 },
                { name: "Blorie l'Assourdissante", id: 2404 },
                { name: "Blordur l'Infect", id: 2405 },
                { name: "Bloporte le Veule", id: 2406 },
                { name: "Blof l'Apathique", id: 2407 },
                { name: "Boombata le Garde", id: 2408 },
                { name: "Farlon l'Enfant", id: 2432 },
                { name: "Cochon de farle", id: 603 },
                { name: "Scaratyn l'Huître", id: 2615 },
                { name: "Chaffoin le Sournois", id: 2421 },
                { name: "Larvomatik le Propre", id: 2339 },
                { name: "Larve Jaune", id: 7988 },
                { name: "Tronkoneuz la Tranchante", id: 2299 },
                { name: "Abrakadnuzar", id: 2385 },
                { name: "Chafemal le Bagarreur", id: 2319 },
                { name: "Crolnareff l'Exilé", id: 2439 },
                { name: "Radoutable le Craint", id: 2350 },
                { name: "Scorpitène l'Enflammé", id: 2285 },
                { name: "Dragnoute l'Irascible", id: 2465 },
                { name: "Bulsavon le Gonflé", id: 2415 },
                { name: "Crustterus l'Organique", id: 2557 },
                { name: "Crustensyl le Pragmatique", id: 2558 },
                { name: "Cruskof le Rustre", id: 2559 },
                { name: "Crusmeyer le Pervers", id: 2560 },
                { name: "Forboyar l'Enigmatique", id: 2328 },
                { name: "Floriste la Cannibale", id: 2392 },
                { name: "Arabord la Cruche", id: 2311 },
                { name: "Grandilok le Clameur", id: 2498 },
                { name: "Grand Pa Wabbit", id: 99 },
                { name: "Wokènrôl le Danseur", id: 2308 },
                { name: "Wo Wabbit", id: 3461 },
                { name: "Cavordemal le Sorcier", id: 2420 },
                { name: "Aboudbra le Porteur", id: 2384 },
                { name: "Ameur la Laide", id: 2391 },
                { name: "Codenlgaz le Problème", id: 2433 },
                { name: "Ginsenk le Stimulant", id: 2493 },
                { name: "Kiroyal le Sirupeux", id: 2508 },
                { name: "Let le Rond", id: 2525 },
                { name: "Nelvin le Boulet", id: 2539 },
                { name: "Nipulnislip l'Exhibitionniste", id: 2540 },
                { name: "Osuxion le Vampirique", id: 2585 },
                { name: "Susbewl l'Hypocrite", id: 2289 },
                { name: "Koktèle le Secoué", id: 2573 },
                { name: "Chafmarcel le Fêtard", id: 2320 },
                { name: "Chalan le Commerçant", id: 2322 },
                { name: "Ramitant le Dilettante", id: 2423 },
                { name: "Ramane d'Égoutant", id: 447 },
                { name: "Doktopuss le Maléfique", id: 2442 },
                { name: "Dok Alako", id: 747 },
                { name: "Germinol l'Indigent", id: 2568 },
                { name: "Koalastrof la Naturelle", id: 2517 },
                { name: "Ouature la Mobile", id: 2616 },
                { name: "Ouassébo l'Esthète", id: 2524 },
                { name: "Ouashouash l'Exubérant", id: 2575 },
                { name: "Palmito le Menteur", id: 2582 },
                { name: "Palmiche le Serein", id: 2583 },
                { name: "Palmiflette le Convivial", id: 2584 },
                { name: "Sampi l'Eternel", id: 2279 },
                { name: "Sanglier des Plaines", id: 297 },
                { name: "Abrakildas le Vénérable", id: 2389 },
                { name: "Cramikaz le Suicidaire", id: 2438 },
                { name: "Craqueleur des Plaines", id: 2882 },
                { name: "Koko la Violente", id: 2592 },
                { name: "Chafrit le Barbare", id: 2422 },
                { name: "Chafer d'Élite", id: 5066 },
                { name: "Craquetou le Fissuré", id: 2556 },
                { name: "Maître Champeur le Sabreur", id: 2359 },
                { name: "Grenuche la Gentille", id: 2593 },
                { name: "Kannibal le Lecteur", id: 2502 },
                { name: "Kapota la Fraise", id: 2507 },
                { name: "Kannémik le Maigre", id: 2505 },
                { name: "Kannisterik le Forcené", id: 2506 },
                { name: "Sarkastik l'Incompris", id: 2590 },
                { name: "Palmbytch la Bronzée", id: 2581 },
                { name: "Ratlbol l'Aigri", id: 2273 },
                { name: "Rat d'Égoutant", id: 4875 },
                { name: "Ougaould le Parasite", id: 2589 },
                { name: "Corboyard l'Enigmatique", id: 2555 },
                { name: "Kwaké le Piraté", id: 2369 },
                { name: "Kwakwatique le Trempé", id: 2368 },
                { name: "Kwakamole l'Appétissant", id: 2367 },
                { name: "Kwakolak le Chocolaté", id: 2451 },
                { name: "Porsalé le Râleur", id: 2453 },
                { name: "Dragioli le Succulent", id: 2459 },
                { name: "Vetaurine l'Énergisé", id: 2455 },
                { name: "Moumoute la Douce", id: 2457 },
                { name: "Parapadkouï l'Émasculé", id: 2527 },
                { name: "Serpistule le Purulent", id: 2287 },
                { name: "Bebetto l'Intellectuel", id: 2510 },
                { name: "Akaka le Souillé", id: 2591 },
                { name: "Rauligo le Sale", id: 2351 },
                { name: "Caboume l'Artilleur", id: 2419 },
                { name: "Tilolo la Bien Moulée", id: 2434 },
                { name: "Nakuneuye le Borgne", id: 2538 },
                { name: "Chiendanlémin l'Illusionniste", id: 2554 },
                { name: "Dragstayr le Fonceur", id: 2377 },
                { name: "Dragoeuf Calcaire", id: 90 },
                { name: "Dragmoclaiss le Fataliste", id: 2372 },
                { name: "Dragoeuf Ardoise", id: 170 },
                { name: "Dragkouine la Déguisée", id: 2450 },
                { name: "Dragoeuf Argile", id: 87 },
                { name: "Dragnostik le Sceptique", id: 2449 },
                { name: "Dragoeuf Charbon", id: 89 },
                { name: "Koamaembair le Coulant", id: 2513 },
                { name: "Koakofrui le Confit", id: 2516 },
                { name: "Koaskette la Chapelière", id: 2509 },
                { name: "Koarmit la Batracienne", id: 2518 },
                { name: "Ratéhaifaim le Professeur", id: 2275 },
                { name: "Sparoket le Lanceur", id: 2588 },
                { name: "Fanlabiz le Véloce", id: 2466 },
                { name: "Fandanleuil le Précis", id: 2467 },
                { name: "Fantoch le Pantin", id: 2563 },
                { name: "Fantrask la Rêveuse", id: 2468 },
                { name: "Barebourd le Comte", id: 2545 },
                { name: "Nerdeubeu le Flagellant", id: 2579 },
                { name: "Crok le Beau", id: 2428 },
                { name: "Chef Crocodaille", id: 263 },
                { name: "Toufou le Benêt", id: 2547 },
                { name: "Bitouf des Plaines", id: 5704 },
                { name: "Crathdogue le Cruel", id: 2561 },
                { name: "Craqueleur Poli", id: 5706 },
                { name: "Alhoui le Répondeur", id: 2472 },
                { name: "Pantacour le Long", id: 2474 },
                { name: "Orfélyre le Charmeur", id: 2476 },
                { name: "Félyssion la Gourmande", id: 2473 },
                { name: "Kanibière l'Encordée", id: 2475 },
                { name: "Kanasukr le Mielleux", id: 2503 },
                { name: "Mufguedin le Suprême", id: 2580 },
                { name: "Muloufok l'Hilarant", id: 2337 },
                { name: "Bonpake le Chavireur", id: 2598 },
                { name: "Kido l'Âtre", id: 2571 },
                { name: "Kilimanj'haro le Grimpeur", id: 2572 },
                { name: "Larvaloeil l'Émue", id: 2448 },
                { name: "Souristiti l'Immortalisée", id: 2447 },
                { name: "Souris Verte", id: 294 },
                { name: "Bourde le Maladroit", id: 2446 },
                { name: "Fouflay le Retombé", id: 2445 },
                { name: "Dragonienne l'Econome", id: 2461 },
                { name: "Guerrite le Veilleur", id: 2497 },
                { name: "Guerrier Koalak", id: 749 },
                { name: "Lichangora l'Immaculée", id: 2412 },
                { name: "Craquecrac l'Endurant", id: 2543 },
                { name: "Craquelourd", id: 4631 },
                { name: "Warkolad l'Etreinte", id: 2306 },
                { name: "Warko Marron", id: 746 },
                { name: "Inopenope le Négatif", id: 2511 },
                { name: "Abrakanette l'Encapsulé", id: 2388 },
                { name: "Abraknyde Sombre", id: 7342 },
                { name: "Tétonée la Plantureuse", id: 2414 },
                { name: "Fossamoel le Juteux", id: 2482 },
                { name: "Fossoyeur Koalak", id: 761 },
                { name: "Gloubibou le Gars", id: 2495 },
                { name: "Koasossyal le Psychopathe", id: 2515 },
                { name: "Koalak Forestier", id: 785 },
                { name: "Pékeutar le Tireur", id: 2271 },
                { name: "Piradain le Pingre", id: 2270 },
                { name: "Abraklette le Fondant", id: 2386 },
                { name: "Abrakne Sombre", id: 7341 },
                { name: "Koamag'oel le Défiguré", id: 2429 },
                { name: "Chevaucheur Koalak", id: 759 },
                { name: "Meuroup le Prêtre", id: 2577 },
                { name: "Rooroku l'Imposant", id: 2398 },
                { name: "Dragdikal le Décisif", id: 2464 },
                { name: "Dragobert le Monarque", id: 2452 },
                { name: "Diskord le Belliqueux", id: 2562 },
                { name: "Brouste l'Humiliant", id: 2550 },
                { name: "Bitoven le Musicien", id: 2546 },
                { name: "Bitouf Sombre", id: 5699 },
                { name: "Ecorfé la Vive", id: 2360 },
                { name: "Floanna la Blonde", id: 2565 },
                { name: "Koalvissie le Chauve", id: 2519 },
                { name: "Koalak Sanguin", id: 744 },
                { name: "Koalaboi le Calorifère", id: 2514 },
                { name: "Mamakomou l'Âge", id: 2528 },
                { name: "Momikonos la Bandelette", id: 2534 },
                { name: "Bouliver le Géant", id: 2363 },
                { name: "Wara l'Amer", id: 2307 },
                { name: "Gastroth la Contagieuse", id: 2566 },
                { name: "Guerumoth le Collant", id: 2569 },
                { name: "Tourbiket le Virevoletant", id: 2361 },
                { name: "Abrakine le Sombre", id: 2544 },
                { name: "Abrakleur Sombre", id: 5698 },
                { name: "Dragminster le Magicien", id: 2454 },
                { name: "Drageaufol la Joyeuse", id: 2460 },
                { name: "Dragtarus le Bellâtre", id: 2456 },
                { name: "Draquetteur le Voleur", id: 2458 },
                { name: "Fangshui la Dysorthographiée", id: 2512 },
                { name: "Pétarfoutu le Mouillé", id: 2278 },
                { name: "Drakolage le Tentateur", id: 2462 },
                { name: "Faufoll la Joyeuse", id: 2567 },
                { name: "Bigbadaboum l'Élémentaire", id: 2526 },
                { name: "Maître Koantik le Théoricien", id: 2531 },
                { name: "Maître Koalak", id: 758 },
                { name: "Poolopo la Traditionnelle", id: 2383 },
                { name: "Trooyé l'Oxydé", id: 2300 },
                { name: "Troollaraj", id: 233 },
                { name: "Seripoth l'Ennemi", id: 2587 },
                { name: "Kaskapointhe la Couverte", id: 2570 },
                { name: "Toutouf le Velu", id: 2382 },
                { name: "Abrinos le Clair", id: 2381 },
                { name: "Don Kizoth l'Obstiné", id: 2578 },
                { name: "Chamiléro le Malchanceux", id: 2553 },
                { name: "Crachefouxtre le Surpris", id: 2303 },
                { name: "Tromplamor le Survivant", id: 2601 },
                { name: "Chamoute le Duveteux", id: 2552 },
                { name: "Tsucékoi la Colporteuse", id: 2370 },
                { name: "Tambouille le Gastronome", id: 2469 },
                { name: "Champoul l'Illuminé", id: 2373 },
                { name: "Champolyon le Polyglotte", id: 2551 },
                { name: "Champ À Gnons", id: 4925 },
                { name: "Champmé le Méchant", id: 2600 },
                { name: "Onabuémangé la Rassasiée", id: 2471 },
                { name: "Jiankor le Radoteur", id: 2374 },
                { name: "Jiangshi-Nobi", id: 6386 },
                { name: "Tronquette la Réduite", id: 2597 },
                { name: "Roy le Merlin", id: 2614 },
                { name: "Madgang le Docteur", id: 2564 },
                { name: "Bakaglace le Congelé", id: 2483 },
                { name: "Kaonucléair l'Instable", id: 2470 },
                { name: "Tsumani l'Inondeur", id: 2477 }
            ];

            // Function to display messages in the UI
            function showStatusMessage(message, type) {
                statusMessageDiv.className = `message ${type}`;
                statusMessageDiv.innerHTML = `<p>${message}</p>`;
            }

            // Function to sanitize filename
            function sanitizeFilename(name) {
                // Remove invalid characters for filenames and replace spaces with underscores
                return name.replace(/[<>:"/\\|?*\s]/g, '_');
            }

            fetchButton.addEventListener('click', async () => {
                showStatusMessage('Récupération des données en cours...', 'info');
                fetchButton.disabled = true; // Désactiver le bouton de récupération pendant le processus
                copyButton.disabled = true; // Désactiver le bouton de copie jusqu'à ce que les résultats soient prêts
                downloadAllButton.disabled = true; // Désactiver le bouton de téléchargement pendant le processus
                monsterGrid.innerHTML = ''; // Effacer les résultats précédents
                monsterListContainer.style.display = 'none'; // Cacher le conteneur jusqu'à ce que les résultats soient prêts
                console.log('Démarrage du processus de récupération des portraits de monstres...');

                monsterResults = {}; // Réinitialiser les résultats
                let fetchedCount = 0;
                const totalMonsters = monstersToFetch.length;

                for (const monster of monstersToFetch) {
                    // Appel API direct en utilisant l'ID du monstre
                    const apiUrl = `${DOFUSDB_API_BASE_URL}/monsters/${monster.id}?lang=fr`;
                    console.log(`Interrogation de DofusDB pour l'ID ${monster.id} (${monster.name})... URL: ${apiUrl}`);

                    try {
                        const monsterResponse = await fetch(apiUrl);
                        const monsterData = await monsterResponse.json();

                        if (!monsterResponse.ok) {
                            console.warn(`La requête API pour l'ID ${monster.id} (${monster.name}) a échoué avec le statut ${monsterResponse.status}. Réponse :`, monsterData);
                            monsterResults[monster.name] = { id: monster.id, img: 'https://placehold.co/80x80/374151/9ca3af?text=?' }; // Placeholder pour erreur
                        } else if (monsterData && monsterData.id) { // Vérifier si monsterData n'est pas vide et a un ID
                            monsterResults[monster.name] = { 
                                id: monsterData.id, 
                                img: monsterData.img || 'https://placehold.co/80x80/374151/9ca3af?text=?' // Utiliser l'image trouvée ou un placeholder
                            };
                            console.log(`Détails trouvés pour "${monster.name}" (ID: ${monsterData.id}), Image: ${monsterData.img}`);
                        } else {
                            monsterResults[monster.name] = { id: monster.id, img: 'https://placehold.co/80x80/374151/9ca3af?text=?' }; // Placeholder pour non trouvé, garder l'ID original
                            console.warn(`Détails non trouvés pour l'ID ${monster.id} (${monster.name}) dans DofusDB.`);
                        }
                    } catch (apiError) {
                        console.error(`Erreur lors de la récupération des détails pour l'ID ${monster.id} (${monster.name}) :`, apiError);
                        monsterResults[monster.name] = { id: monster.id, img: 'https://placehold.co/80x80/374151/9ca3af?text=?' }; // Placeholder pour erreur de récupération
                    }
                    fetchedCount++;
                    showStatusMessage(`Récupération des monstres... (${fetchedCount}/${totalMonsters})`, 'info');
                    await new Promise(resolve => setTimeout(resolve, 100)); // Petite pause pour éviter de dépasser les limites de taux de l'API
                }

                console.log('\n--- IDs et Portraits des Monstres DofusDB ---');
                let resultsTextForCopy = "IDs des Monstres DofusDB :\n";
                
                // Afficher les résultats dans la grille
                for (const name in monsterResults) {
                    const monsterInfo = monsterResults[name];
                    const monsterItemDiv = document.createElement('div');
                    monsterItemDiv.classList.add('monster-item');
                    monsterItemDiv.innerHTML = `
                        <img src="${monsterInfo.img}" alt="Portrait de ${name}" onerror="this.onerror=null;this.src='https://placehold.co/80x80/374151/9ca3af?text=?';">
                        <p>${name}</p>
                        <span class="monster-id">ID: ${monsterInfo.id}</span>
                    `;
                    monsterGrid.appendChild(monsterItemDiv);

                    const line = `${name}: ${monsterInfo.id}`;
                    console.log(line);
                    resultsTextForCopy += line + "\n";
                }
                console.log('---------------------------\n');

                monsterListContainer.style.display = 'block'; // Afficher le conteneur
                showStatusMessage('Monstres récupérés avec succès ! Vérifiez la console et la liste ci-dessous. Vous pouvez maintenant copier les IDs ou télécharger les portraits.', 'success');
                copyButton.disabled = false; // Activer le bouton de copie
                downloadAllButton.disabled = false; // Activer le bouton de téléchargement
                fetchButton.disabled = false; // Réactiver le bouton de récupération après achèvement ou erreur

            });

            copyButton.addEventListener('click', () => {
                let textToCopy = "IDs des Monstres DofusDB :\n";
                for (const name in monsterResults) {
                    textToCopy += `${name}: ${monsterResults[name].id}\n`;
                }

                const textarea = document.createElement('textarea');
                textarea.value = textToCopy;
                textarea.style.position = 'fixed'; // Empêcher le défilement vers le bas
                textarea.style.opacity = '0'; // Rendre invisible
                document.body.appendChild(textarea);
                textarea.select();

                try {
                    const successful = document.execCommand('copy');
                    if (successful) {
                        showStatusMessage('IDs copiés dans le presse-papiers !', 'success');
                    } else {
                        showStatusMessage('Échec de la copie des IDs. Veuillez copier manuellement depuis la console.', 'error');
                    }
                } catch (err) {
                    console.error('La commande de copie a échoué :', err);
                    showStatusMessage('Échec de la copie des IDs. Veuillez copier manuellement depuis la console.', 'error');
                } finally {
                    document.body.removeChild(textarea);
                }
            });

            downloadAllButton.addEventListener('click', async () => {
                showStatusMessage('Téléchargement des portraits en cours...', 'info');
                downloadAllButton.disabled = true; // Désactiver le bouton pendant le téléchargement

                let downloadCount = 0;
                const totalImages = Object.keys(monsterResults).length;

                for (const name in monsterResults) {
                    const monsterInfo = monsterResults[name];
                    if (monsterInfo.img && !monsterInfo.img.includes('placehold.co')) { // Only download if it's a valid image URL
                        try {
                            const response = await fetch(monsterInfo.img);
                            if (!response.ok) {
                                throw new Error(`HTTP error! status: ${response.status}`);
                            }
                            const blob = await response.blob();
                            const url = URL.createObjectURL(blob);

                            const a = document.createElement('a');
                            a.href = url;
                            // Sanitize filename to avoid issues with invalid characters
                            const filename = `${sanitizeFilename(name)}_${monsterInfo.id}.png`;
                            a.download = filename;
                            document.body.appendChild(a);
                            a.click();
                            document.body.removeChild(a);
                            URL.revokeObjectURL(url); // Clean up the object URL

                            downloadCount++;
                            showStatusMessage(`Téléchargement des portraits... (${downloadCount}/${totalImages})`, 'info');
                            // Add a small delay between downloads to prevent browser from blocking
                            await new Promise(resolve => setTimeout(resolve, 200)); 

                        } catch (error) {
                            console.error(`Erreur lors du téléchargement de l'image pour "${name}" (ID: ${monsterInfo.id}):`, error);
                            // Continue with next image even if one fails
                        }
                    }
                }
                showStatusMessage('Tous les portraits disponibles ont été téléchargés !', 'success');
                downloadAllButton.disabled = false; // Réactiver le bouton après le téléchargement
            });
        });
    </script>
</body>
</html>
